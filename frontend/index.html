<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="description" content="Professional Game Server Management Dashboard" />
        <meta
            name="keywords"
            content="game server hosting, minecraft server hosting, server management, game panel, minecraft panel, server control panel"
        />
        <meta name="theme-color" content="#1a1a1a" />
        <meta name="msapplication-navbutton-color" content="#1a1a1a" />
        <meta name="apple-mobile-web-app-status-bar-style" content="#1a1a1a" />
        <meta property="og:title" content="FeatherPanel Game Server Dashboard" />
        <meta
            property="og:description"
            content="Professional game server management dashboard for Minecraft and other games"
        />
        <meta property="og:type" content="website" />
        <meta name="twitter:card" content="summary_large_image" />
        <meta name="twitter:title" content="FeatherPanel Game Server Dashboard" />

        <!-- Standard favicon -->
        <link rel="icon" type="image/png" sizes="32x32" href="https://cdn.mythical.systems/featherpanel/logo.png" />
        <link rel="icon" type="image/png" sizes="16x16" href="https://cdn.mythical.systems/featherpanel/logo.png" />
        <!-- ICO fallback for Firefox and legacy browsers -->
        <link rel="icon" type="image/x-icon" href="https://cdn.mythical.systems/featherpanel/logo.ico" />
        <link rel="shortcut icon" href="https://cdn.mythical.systems/featherpanel/logo.ico" />
        <!-- Apple Touch Icon -->
        <link rel="apple-touch-icon" href="https://cdn.mythical.systems/featherpanel/logo.png" />
        <meta
            name="twitter:description"
            content="Professional game server management dashboard for Minecraft and other games"
        />
        <meta author="FeatherPanel" />
        <meta name="robots" content="index, follow" />

        <!-- PWA Manifest and Service Worker Registration -->
        <link rel="manifest" href="/api/manifest.webmanifest" />

        <!-- iOS Splash Images (add as desired or for different devices) -->
        <!-- <link rel="apple-touch-startup-image" href="/splash.png" /> -->

        <title>FeatherPanel</title>

        <!-- Telemetry Tracking URL -->
        <script>
            // Robust telemetry loading that respects user preferences
            (function () {
                let telemetryLoaded = false;

                function loadTelemetry() {
                    if (telemetryLoaded) return;

                    try {
                        var telemetrySetting = window.localStorage.getItem('telemetry');
                        if (telemetrySetting !== 'false') {
                            var s = document.createElement('script');
                            s.defer = true;
                            s.src = 'https://dynhost.mythical.systems/script.js';
                            s.setAttribute('data-website-id', '71281b01-8c95-4fac-9f58-6d68aac179d7');
                            document.head.appendChild(s);
                            telemetryLoaded = true;
                        }
                    } catch (e) {
                        /* Silent fail, block all telemetry on errors */
                    }
                }

                // Try to load immediately
                loadTelemetry();

                // Also listen for localStorage changes (in case preferences are restored later)
                window.addEventListener('storage', function (e) {
                    if (e.key === 'telemetry' && e.newValue === 'false') {
                        // If telemetry is disabled, remove any existing telemetry scripts
                        var existingScripts = document.querySelectorAll('script[src*="dynhost.mythical.systems"]');
                        existingScripts.forEach(function (script) {
                            script.remove();
                        });
                        telemetryLoaded = false;
                    } else if (e.key === 'telemetry' && e.newValue !== 'false' && !telemetryLoaded) {
                        // If telemetry is enabled and not loaded yet, load it
                        loadTelemetry();
                    }
                });

                // Also check after a short delay in case preferences are restored
                setTimeout(loadTelemetry, 1000);
            })();
        </script>
        <!-- Telemetry Tracking URL -->

        <!-- Custom Scrollbar and Preloader Styles -->
        <style>
            /* Custom Dark Mode Scrollbar */
            ::-webkit-scrollbar {
                width: 12px;
                height: 12px;
            }

            ::-webkit-scrollbar-track {
                background: transparent;
                border-radius: 6px;
            }

            ::-webkit-scrollbar-thumb {
                background: #374151;
                border-radius: 6px;
                border: 2px solid transparent;
                transition: all 0.3s ease;
            }

            ::-webkit-scrollbar-thumb:hover {
                background: #4b5563;
                transform: scale(1.05);
            }

            ::-webkit-scrollbar-corner {
                background: transparent;
            }

            /* Firefox Scrollbar */
            * {
                scrollbar-width: thin;
                scrollbar-color: #374151 transparent;
            }

            /* Preloader Styles - Professional Dark Design */
            .preloader {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: #020203;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                z-index: 9999;
                transition:
                    opacity 0.6s cubic-bezier(0.4, 0, 0.2, 1),
                    transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
                overflow: hidden;
            }

            /* Subtle grid background */
            .preloader::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-image:
                    linear-gradient(rgba(255, 255, 255, 0.02) 1px, transparent 1px),
                    linear-gradient(90deg, rgba(255, 255, 255, 0.02) 1px, transparent 1px);
                background-size: 50px 50px;
                opacity: 0.3;
            }

            /* Very subtle ambient glow */
            .preloader::after {
                content: '';
                position: absolute;
                top: 50%;
                left: 50%;
                width: 600px;
                height: 600px;
                background: radial-gradient(circle, rgba(255, 255, 255, 0.01) 0%, transparent 70%);
                transform: translate(-50%, -50%);
            }

            /* Light theme */
            .preloader.light {
                background: #ffffff;
            }

            .preloader.light::before {
                background-image:
                    linear-gradient(rgba(0, 0, 0, 0.04) 1px, transparent 1px),
                    linear-gradient(90deg, rgba(0, 0, 0, 0.04) 1px, transparent 1px);
                opacity: 0.5;
            }

            .preloader.light::after {
                background: radial-gradient(circle, rgba(0, 0, 0, 0.01) 0%, transparent 70%);
            }

            .preloader.fade-out {
                opacity: 0;
                transform: scale(1.05);
                pointer-events: none;
            }

            /* Main content container */
            .preloader-content {
                position: relative;
                z-index: 1;
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 2rem;
            }

            /* Modern card-style container */
            .preloader-card {
                background: rgba(10, 10, 10, 0.5);
                backdrop-filter: blur(20px);
                border: 1px solid rgba(255, 255, 255, 0.08);
                border-radius: 12px;
                padding: 3rem 4rem;
                box-shadow:
                    0 20px 60px rgba(0, 0, 0, 0.5),
                    0 0 0 1px rgba(255, 255, 255, 0.02) inset;
                transition: all 0.3s ease;
                min-width: 420px;
                max-width: 90vw;
                width: 100%;
            }

            .preloader.light .preloader-card {
                background: rgba(255, 255, 255, 0.9);
                border: 1px solid rgba(0, 0, 0, 0.1);
                box-shadow:
                    0 20px 60px rgba(0, 0, 0, 0.08),
                    0 0 0 1px rgba(0, 0, 0, 0.02) inset;
            }

            /* Logo container with modern design */
            .preloader-logo-container {
                position: relative;
                width: 100px;
                height: 100px;
                margin: 0 auto 2rem;
            }

            .preloader-logo {
                width: 100%;
                height: 100%;
                position: relative;
                display: flex;
                align-items: center;
                justify-content: center;
                background: rgba(255, 255, 255, 0.03);
                border-radius: 20px;
                border: 1px solid rgba(255, 255, 255, 0.1);
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
                transition: all 0.3s ease;
            }

            .preloader.light .preloader-logo {
                background: rgba(0, 0, 0, 0.02);
                border: 1px solid rgba(0, 0, 0, 0.1);
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
            }

            /* Subtle border effect */
            .preloader-logo::before {
                content: '';
                position: absolute;
                inset: -1px;
                border-radius: 20px;
                padding: 1px;
                background: linear-gradient(
                    45deg,
                    rgba(255, 255, 255, 0.1),
                    rgba(255, 255, 255, 0.05),
                    rgba(255, 255, 255, 0.1)
                );
                -webkit-mask:
                    linear-gradient(#fff 0 0) content-box,
                    linear-gradient(#fff 0 0);
                -webkit-mask-composite: xor;
                mask:
                    linear-gradient(#fff 0 0) content-box,
                    linear-gradient(#fff 0 0);
                mask-composite: exclude;
                opacity: 0.5;
                animation: logoRotate 8s linear infinite;
            }

            .preloader.light .preloader-logo::before {
                background: linear-gradient(45deg, rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.05), rgba(0, 0, 0, 0.1));
                opacity: 0.6;
            }

            /* Icon */
            .preloader-logo::after {
                content: '⚡';
                font-size: 3rem;
                filter: drop-shadow(0 2px 8px rgba(255, 255, 255, 0.1));
            }

            /* Hide emoji when custom logo is present */
            .preloader-logo.has-custom-logo::after {
                opacity: 0;
                transform: scale(0.8);
                transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            }

            /* Smooth transitions for logo changes */
            .preloader-logo img {
                opacity: 0;
                transform: scale(0.8);
                transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%) scale(0.8);
                width: 60px;
                height: 60px;
                object-fit: contain;
                border-radius: 8px;
                z-index: 1;
            }

            .preloader-logo.has-custom-logo img {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }

            .preloader-logo::after {
                transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            }

            /* Brand name */
            .preloader-brand {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
                font-size: 1.75rem;
                font-weight: 700;
                color: #ffffff;
                text-align: center;
                margin-bottom: 0.5rem;
                letter-spacing: -0.02em;
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                opacity: 1;
                transform: translateY(0);
            }

            .preloader-brand.updating {
                opacity: 0;
                transform: translateY(-10px);
            }

            .preloader.light .preloader-brand {
                color: #0a0a0a;
            }

            /* Status text */
            .preloader-status {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
                font-size: 0.875rem;
                color: rgba(255, 255, 255, 0.5);
                text-align: center;
                margin-bottom: 2rem;
                font-weight: 500;
                transition: all 0.3s ease;
            }

            .preloader.light .preloader-status {
                color: rgba(0, 0, 0, 0.5);
            }

            /* Progress bar container */
            .preloader-progress-container {
                width: 100%;
                margin-bottom: 1.5rem;
            }

            .preloader-progress-label {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 0.75rem;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
                font-size: 0.8125rem;
                color: rgba(255, 255, 255, 0.4);
                font-weight: 500;
            }

            .preloader.light .preloader-progress-label {
                color: rgba(0, 0, 0, 0.4);
            }

            .preloader-percentage {
                font-variant-numeric: tabular-nums;
                color: rgba(255, 255, 255, 0.8);
                font-weight: 600;
            }

            .preloader.light .preloader-percentage {
                color: rgba(0, 0, 0, 0.8);
            }

            .loading-bar {
                width: 100%;
                height: 6px;
                background: rgba(255, 255, 255, 0.05);
                border-radius: 999px;
                overflow: hidden;
                position: relative;
                box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.1) inset;
            }

            .preloader.light .loading-bar {
                background: rgba(0, 0, 0, 0.08);
                box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.05) inset;
            }

            .loading-progress {
                height: 100%;
                background: rgba(255, 255, 255, 0.9);
                border-radius: 999px;
                width: 0%;
                position: relative;
                box-shadow: 0 0 10px rgba(255, 255, 255, 0.2);
                transition: width 0.3s ease-out;
            }

            .preloader.light .loading-progress {
                background: rgba(0, 0, 0, 0.9);
                box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            }

            /* Shimmer effect on progress bar */
            .loading-progress::after {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
                animation: loadingShimmer 2s ease-in-out infinite;
            }

            .preloader.light .loading-progress::after {
                background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            }

            /* System status indicators */
            .system-status {
                display: flex;
                gap: 1.5rem;
                justify-content: center;
                margin-top: 1.5rem;
                padding-top: 1.5rem;
                border-top: 1px solid rgba(255, 255, 255, 0.05);
            }

            .preloader.light .system-status {
                border-top: 1px solid rgba(0, 0, 0, 0.08);
            }

            .status-item {
                display: flex;
                align-items: center;
                gap: 0.5rem;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
                font-size: 0.75rem;
                color: rgba(255, 255, 255, 0.35);
                font-weight: 500;
            }

            .preloader.light .status-item {
                color: rgba(0, 0, 0, 0.4);
            }

            .status-indicator {
                width: 6px;
                height: 6px;
                border-radius: 50%;
                background: rgba(255, 255, 255, 0.6);
                box-shadow: 0 0 8px rgba(255, 255, 255, 0.3);
                animation: statusBlink 2s ease-in-out infinite;
                position: relative;
            }

            .preloader.light .status-indicator {
                background: rgba(0, 0, 0, 0.5);
                box-shadow: 0 0 8px rgba(0, 0, 0, 0.2);
            }

            .status-indicator::before {
                content: '';
                position: absolute;
                inset: -2px;
                border-radius: 50%;
                background: inherit;
                opacity: 0.3;
                animation: statusRipple 2s ease-in-out infinite;
            }

            /* Animations */
            @keyframes logoRotate {
                0% {
                    transform: rotate(0deg);
                }
                100% {
                    transform: rotate(360deg);
                }
            }

            @keyframes iconPulse {
                0%,
                100% {
                    opacity: 1;
                    transform: scale(1);
                }
                50% {
                    opacity: 0.8;
                    transform: scale(1.05);
                }
            }

            @keyframes loadingShimmer {
                0% {
                    transform: translateX(-100%);
                }
                100% {
                    transform: translateX(200%);
                }
            }

            @keyframes statusBlink {
                0%,
                100% {
                    opacity: 1;
                }
                50% {
                    opacity: 0.5;
                }
            }

            @keyframes statusRipple {
                0% {
                    transform: scale(1);
                    opacity: 0.3;
                }
                50% {
                    transform: scale(1.5);
                    opacity: 0;
                }
                100% {
                    transform: scale(1);
                    opacity: 0;
                }
            }

            /* Hide preloader when app is ready */
            .preloader.hidden {
                display: none;
            }

            /* Responsive design */
            @media (max-width: 640px) {
                .preloader-card {
                    min-width: unset;
                    width: 90%;
                    padding: 2rem 1.5rem;
                    margin: 0 1rem;
                }

                .preloader-logo-container {
                    width: 80px;
                    height: 80px;
                }

                .preloader-brand {
                    font-size: 1.5rem;
                }

                .system-status {
                    flex-direction: column;
                    gap: 0.75rem;
                }
            }

            @media (max-width: 480px) {
                .preloader-card {
                    padding: 1.5rem 1rem;
                    margin: 0 0.5rem;
                }

                .preloader-logo-container {
                    width: 70px;
                    height: 70px;
                }

                .preloader-brand {
                    font-size: 1.25rem;
                }

                .preloader-status {
                    font-size: 0.75rem;
                }
            }
        </style>

        <!-- FEATHERPANEL_HEADER_PLACEHOLDER_START -->
        <!-- FEATHERPANEL_HEADER_PLACEHOLDER_END -->
    </head>
    <body class="dark">
        <!-- Modern shadcn Game Panel Preloader -->
        <div class="preloader" id="preloader">
            <div class="preloader-content">
                <div class="preloader-card">
                    <div class="preloader-logo-container">
                        <div class="preloader-logo"></div>
                    </div>
                    <div class="preloader-brand">FeatherPanel</div>
                    <div class="preloader-status" id="status-text">Initializing system...</div>
                    <div class="preloader-progress-container">
                        <div class="preloader-progress-label">
                            <span id="progress-text">Loading assets</span>
                            <span class="preloader-percentage" id="progress-percentage">0%</span>
                        </div>
                        <div class="loading-bar">
                            <div class="loading-progress" id="loading-progress"></div>
                        </div>
                    </div>
                    <div class="system-status">
                        <div class="status-item">
                            <div class="status-indicator"></div>
                            <span>API</span>
                        </div>
                        <div class="status-item">
                            <div class="status-indicator"></div>
                            <span>Database</span>
                        </div>
                        <div class="status-item">
                            <div class="status-indicator"></div>
                            <span>Cache</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="app">
            <!-- FEATHERPANEL_APP_PLACEHOLDER_START -->
            <!-- Your app content will be here -->
            <!-- FEATHERPANEL_APP_PLACEHOLDER_END -->
        </div>

        <script type="module" src="/src/main.ts" crossorigin></script>

        <!-- Preloader Script -->
        <script>
            // Theme management for preloader - Initialize immediately
            let currentTheme = 'dark';

            // Function to update preloader theme
            function updatePreloaderTheme(theme) {
                const preloader = document.getElementById('preloader');
                if (preloader) {
                    if (theme === 'light') {
                        preloader.classList.add('light');
                        preloader.classList.remove('dark');
                    } else {
                        preloader.classList.remove('light');
                        preloader.classList.add('dark');
                    }
                }
            }

            // Function to update custom branding
            function updateCustomBranding() {
                const appName = localStorage.getItem('appName');
                const appLogoDark = localStorage.getItem('appLogoDark');
                const appLogoWhite = localStorage.getItem('appLogoWhite');

                console.log('[Preloader] Custom branding:', { appName, appLogoDark, appLogoWhite });

                // Update app name with smooth animation
                const brandElement = document.querySelector('.preloader-brand');
                if (brandElement && appName) {
                    // Add updating class for smooth transition
                    brandElement.classList.add('updating');

                    setTimeout(() => {
                        brandElement.textContent = appName;
                        brandElement.classList.remove('updating');
                    }, 150);
                }

                // Update logo based on current theme
                const logoElement = document.querySelector('.preloader-logo');
                if (logoElement) {
                    // Determine which logo to use based on theme
                    const isDarkTheme =
                        document.body.classList.contains('dark') ||
                        (!document.body.classList.contains('light') &&
                            window.matchMedia('(prefers-color-scheme: dark)').matches);

                    const logoToUse = isDarkTheme ? appLogoDark : appLogoWhite;
                    console.log('[Preloader] Theme:', isDarkTheme ? 'dark' : 'light', 'Logo to use:', logoToUse);

                    if (logoToUse) {
                        // Add class to hide the emoji with smooth transition
                        logoElement.classList.add('has-custom-logo');

                        // Create image element if it doesn't exist
                        let logoImg = logoElement.querySelector('img');
                        if (!logoImg) {
                            logoImg = document.createElement('img');
                            logoElement.appendChild(logoImg);
                        }

                        // Set the logo source
                        logoImg.src = logoToUse;
                        logoImg.alt = appName || 'App Logo';
                        console.log('[Preloader] Setting logo src:', logoToUse);

                        // Handle image load errors
                        logoImg.onerror = function () {
                            console.log('[Preloader] Logo failed to load, falling back to emoji');
                            // Fallback to default emoji if image fails to load
                            logoElement.classList.remove('has-custom-logo');
                            logoImg.remove();
                        };
                    } else {
                        // Show default emoji if no custom logo
                        logoElement.classList.remove('has-custom-logo');
                        const existingImg = logoElement.querySelector('img');
                        if (existingImg) {
                            existingImg.remove();
                        }
                        console.log('[Preloader] No custom logo found, showing default emoji');
                    }
                }
            }

            // Function to get current theme
            function getCurrentTheme() {
                const savedTheme = localStorage.getItem('theme');
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                return savedTheme || (prefersDark ? 'dark' : 'light');
            }

            // Initialize preloader theme immediately
            function initializePreloaderTheme() {
                currentTheme = getCurrentTheme();
                updatePreloaderTheme(currentTheme);
            }

            // Initialize custom branding immediately
            function initializeCustomBranding() {
                updateCustomBranding();
            }

            // Apply theme immediately when script runs
            (function () {
                // Get theme before DOM is ready
                const savedTheme = localStorage.getItem('theme');
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                const theme = savedTheme || (prefersDark ? 'dark' : 'light');

                // Apply theme to body immediately
                if (theme === 'light') {
                    document.body.classList.add('light');
                    document.body.classList.remove('dark');
                } else {
                    document.body.classList.add('dark');
                    document.body.classList.remove('light');
                }

                // Store current theme
                currentTheme = theme;

                // Apply theme to preloader if it exists
                const preloader = document.getElementById('preloader');
                if (preloader) {
                    updatePreloaderTheme(theme);
                }

                // Apply custom branding if it exists
                initializeCustomBranding();
            })();

            // Listen for theme changes
            window.addEventListener('theme-changed', (event) => {
                currentTheme = event.detail.theme;
                updatePreloaderTheme(currentTheme);
                updateCustomBranding(); // Update logo when theme changes
            });

            // Listen for system theme changes
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
                if (!localStorage.getItem('theme')) {
                    // Only auto-update if no manual preference
                    currentTheme = e.matches ? 'dark' : 'light';
                    updatePreloaderTheme(currentTheme);
                }
            });

            // Modern loading stages with progress tracking
            const loadingStages = [
                { message: 'Initializing core systems', progress: 15 },
                { message: 'Loading asset bundles', progress: 25 },
                { message: 'Compiling shaders', progress: 35 },
                { message: 'Building caches', progress: 45 },
                { message: 'Initializing renderer', progress: 55 },
                { message: 'Loading configurations', progress: 65 },
                { message: 'Preparing components', progress: 75 },
                { message: 'Setting up networking', progress: 85 },
                { message: 'Finalizing startup', progress: 95 },
            ];

            let currentStageIndex = 0;
            let messageInterval;
            let progressInterval;
            let isPageFullyLoaded = false;
            let currentProgress = 0;
            let preloaderStartTime = Date.now();
            const MIN_PRELOADER_DISPLAY_TIME = 1500; // Reduced to 1.5 seconds for faster loading

            // Function to update progress
            function updateProgress(targetProgress, message) {
                const progressBar = document.getElementById('loading-progress');
                const progressText = document.getElementById('progress-text');
                const progressPercentage = document.getElementById('progress-percentage');
                const statusText = document.getElementById('status-text');

                if (progressBar && progressPercentage && progressText) {
                    // Smooth progress animation
                    const startProgress = currentProgress;
                    const progressDiff = targetProgress - startProgress;
                    const duration = 600; // ms
                    const startTime = Date.now();

                    const animateProgress = () => {
                        const elapsed = Date.now() - startTime;
                        const progress = Math.min(elapsed / duration, 1);
                        const easeProgress =
                            progress < 0.5 ? 2 * progress * progress : 1 - Math.pow(-2 * progress + 2, 2) / 2;

                        currentProgress = startProgress + progressDiff * easeProgress;
                        progressBar.style.width = currentProgress + '%';
                        progressPercentage.textContent = Math.round(currentProgress) + '%';

                        if (progress < 1) {
                            requestAnimationFrame(animateProgress);
                        }
                    };

                    animateProgress();
                    progressText.textContent = message;
                    if (statusText) {
                        statusText.textContent = message + '...';
                    }
                }
            }

            // Function to show next loading stage
            function showNextStage() {
                if (currentStageIndex < loadingStages.length) {
                    const stage = loadingStages[currentStageIndex];
                    updateProgress(stage.progress, stage.message);
                    currentStageIndex++;
                } else {
                    clearInterval(messageInterval);
                }
            }

            // Function to hide preloader
            function hidePreloader() {
                const preloader = document.getElementById('preloader');
                if (preloader) {
                    clearInterval(messageInterval);
                    clearInterval(progressInterval);

                    // Complete progress to 100%
                    updateProgress(100, 'Ready');

                    setTimeout(() => {
                        preloader.classList.add('fade-out');
                        setTimeout(() => {
                            preloader.classList.add('hidden');
                        }, 600);
                    }, 300);
                }
            }

            // Function to hide preloader with minimum display time check
            function hidePreloaderWithDelay() {
                const elapsedTime = Date.now() - preloaderStartTime;
                const remainingTime = Math.max(0, MIN_PRELOADER_DISPLAY_TIME - elapsedTime);

                // Ensure minimum display time before hiding
                setTimeout(() => {
                    hidePreloader();
                }, remainingTime);
            }

            // Initialize theme when DOM is ready (for any remaining elements)
            document.addEventListener('DOMContentLoaded', () => {
                // Ensure theme is applied to any newly created elements
                updatePreloaderTheme(currentTheme);

                // Ensure custom branding is applied
                updateCustomBranding();

                // Initialize progress with first stage
                showNextStage();

                // Start showing loading stages
                messageInterval = setInterval(() => {
                    showNextStage();
                }, 400); // Show stage every 400ms for faster progression

                // Check if Vue app is ready
                const checkAppReady = setInterval(() => {
                    if (document.querySelector('#app').children.length > 0) {
                        clearInterval(checkAppReady);

                        // If page is already loaded, proceed with hiding (with minimum time check)
                        if (isPageFullyLoaded) {
                            setTimeout(() => {
                                hidePreloaderWithDelay();
                            }, 500);
                        }
                    }
                }, 100);
            });

            // Track page load progress
            window.addEventListener('load', () => {
                isPageFullyLoaded = true;

                // Wait for remaining stages to complete
                setTimeout(() => {
                    if (isPageFullyLoaded) {
                        clearInterval(messageInterval);

                        // Show final completion message (with minimum time check)
                        setTimeout(() => {
                            hidePreloaderWithDelay();
                        }, 800);
                    }
                }, 500);
            });
        </script>

        <!-- FEATHERPANEL_FOOTER_PLACEHOLDER_START -->
        <!-- FEATHERPANEL_FOOTER_PLACEHOLDER_END -->
    </body>
</html>
